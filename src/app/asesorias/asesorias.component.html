<div class="p-6 max-w-6xl mx-auto">

  <h1 class="text-3xl font-bold text-emerald-600 mb-6">
    üìä Gesti√≥n de Asesor√≠as
  </h1>

  <!-- Buscar + Nuevo -->
  <div class="mb-6 flex flex-col md:flex-row gap-4 justify-between items-center">

    <input
      type="text"
      class="w-full md:w-1/3 px-4 py-2 border rounded-lg shadow-sm"
      placeholder="Buscar asesor√≠a..."
      [(ngModel)]="filtro"
    />

    <button
      class="bg-emerald-500 text-white px-4 py-2 rounded-lg shadow hover:bg-emerald-600"
      (click)="modalAbierto.set(true)"
    >
      ‚ûï Nueva Asesor√≠a
    </button>

  </div>

  <!-- TABLA -->
  <div class="overflow-x-auto rounded-xl shadow">
    <table class="w-full text-left bg-white">
      <thead class="bg-emerald-100">
        <tr>
          <th class="p-3">Cliente</th>
          <th class="p-3">Tema</th>
          <th class="p-3">Fecha</th>
          <th class="p-3">Monto</th>
          <th class="p-3">Estado</th>
          <th class="p-3 text-center">Acciones</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let a of asesoriasFiltradas()" class="border-b hover:bg-gray-50">
          <td class="p-3">{{ a.cliente }}</td>
          <td class="p-3">{{ a.tema }}</td>
          <td class="p-3">{{ a.fecha }}</td>
          <td class="p-3">S/{{ a.monto }}</td>

          <td class="p-3">
            <span
              class="px-3 py-1 rounded-full text-sm"
              [ngClass]="{
                'bg-green-200 text-green-700': a.estado === 'Completada',
                'bg-yellow-200 text-yellow-700': a.estado === 'Pendiente'
              }"
            >
              {{ a.estado }}
            </span>
          </td>

          <td class="p-3 text-center">
            <button class="text-emerald-600 font-semibold hover:underline"
                    (click)="abrirModal(a)">
              Ver
            </button>
          </td>
        </tr>

        <tr *ngIf="asesoriasFiltradas().length === 0">
          <td colspan="6" class="p-4 text-center text-gray-500">
            No se encontraron resultados...
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- MODAL -->
  <div *ngIf="modalAbierto()" class="fixed inset-0 bg-black/40 flex items-center justify-center z-50">

    <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-lg">

      <!-- SI HAY UNA ASESOR√çA SELECCIONADA -->
      <div *ngIf="asesoriaSeleccionada() as selected">

        <h2 class="text-xl font-bold text-emerald-700 mb-4">
          Detalles de Asesor√≠a
        </h2>

        <p><strong>Cliente:</strong> {{ selected.cliente }}</p>
        <p><strong>Tema:</strong> {{ selected.tema }}</p>
        <p><strong>Fecha:</strong> {{ selected.fecha }}</p>
        <p><strong>Monto:</strong> S/{{ selected.monto }}</p>
        <p><strong>Estado:</strong> {{ selected.estado }}</p>
        <p><strong>Descripci√≥n:</strong> {{ selected.descripcion }}</p>

        <button class="mt-4 w-full py-2 rounded-lg bg-gray-300 hover:bg-gray-400"
                (click)="cerrarModal()">
          Cerrar
        </button>

      </div>

      <!-- FORMULARIO NUEVA ASESOR√çA -->
      <div *ngIf="!asesoriaSeleccionada()">

        <h2 class="text-xl font-bold text-emerald-700 mb-4">
          Nueva Asesor√≠a
        </h2>

        <form (ngSubmit)="agregarAsesoria()">

          <input class="w-full my-2 p-2 border rounded" placeholder="Cliente"
                 [(ngModel)]="nuevaAsesoria.cliente" name="cliente">

          <input class="w-full my-2 p-2 border rounded" placeholder="Tema"
                 [(ngModel)]="nuevaAsesoria.tema" name="tema">

          <input type="date" class="w-full my-2 p-2 border rounded"
                 [(ngModel)]="nuevaAsesoria.fecha" name="fecha">

          <input type="number" class="w-full my-2 p-2 border rounded" placeholder="Monto"
                 [(ngModel)]="nuevaAsesoria.monto" name="monto">

          <textarea class="w-full p-2 border rounded" rows="3"
                    placeholder="Descripci√≥n"
                    [(ngModel)]="nuevaAsesoria.descripcion" name="descripcion">
          </textarea>

          <button class="bg-emerald-600 text-white w-full py-2 mt-3 rounded-lg hover:bg-emerald-700">
            Guardar
          </button>

        </form>

        <button
          class="mt-4 w-full py-2 rounded-lg bg-gray-300 hover:bg-gray-400"
          (click)="cerrarModal()"
        >
          Cancelar
        </button>

      </div>

    </div>

  </div>

</div>
